# Парсер телевизионных спортивных событий

Проект представляет собой приложение на Python для парсинга и обработки расписания телевизионных спортивных трансляций.

## Описание

- **Назначение:** Сбор и предоставление информации о предстоящих спортивных событиях на ТВ.
- **Язык:** Python
- **Архитектурные паттерны:**
  - Unit of Work (для управления сессиями БД)
  - Repository (для работы с моделями и БД)

## Настройка и Запуск

### Зависимости

Основные зависимости проекта перечислены в файле `req.txt`. Установите их с помощью pip:

```bash
pip install -r req.txt
```
Ключевые библиотеки:
- `SQLAlchemy[asyncio]`, `asyncpg`: для асинхронной работы с PostgreSQL.
- `pydantic`, `pydantic-settings`: для валидации данных и управления конфигурацией.
- `loguru`: для удобного логирования.
- `aiocron`: для асинхронного планирования задач.
- `aiohttp`: для асинхронных HTTP-запросов (используется парсером).

### Конфигурация

Основные параметры приложения настраиваются через переменные окружения. Файл `.env` используется для их загрузки (см. `config.py`). Основные переменные:

- `MLDB_USER`, `MLDB_PASSWORD`, `MLDB_HOST`, `MLDB_PORT`, `MLDB_NAME`: Параметры подключения к PostgreSQL.
- `DEBUG`: Режим отладки (True/False).
- `YANDEX_TV_COOKIES`: Cookies для запросов к API Яндекс.ТВ (в формате строки JSON).
- `YANDEX_TV_HEADERS`: Заголовки для запросов к API Яндекс.ТВ (в формате строки JSON).

Значения по умолчанию для подключения к БД: `postgres`/`postgres`@`localhost`:`5432`/`public`.

### Логирование

Приложение использует `loguru` для логирования. Настройки находятся в `config.py`. Логи выводятся в консоль и записываются в файл `logs/app.log` с ротацией и хранением за последние 10 дней. Папка `logs` не отслеживается Git.

### База данных

Проект использует PostgreSQL в качестве базы данных. Для локальной разработки и тестирования можно использовать Docker Compose.

**Запуск БД через Docker Compose:**

1.  Убедитесь, что у вас установлен Docker и Docker Compose.
2.  (Опционально) Создайте файл `.env` в корне проекта и укажите свои значения для переменных `POSTGRES_DB`, `POSTGRES_USER`, `POSTGRES_PASSWORD` (эти переменные используются в `docker-compose.yml`). Если файл `.env` не создан, будут использованы значения по умолчанию (`public`, `postgres`, `postgres`).
3.  Запустите контейнер с базой данных:

    ```bash
    docker-compose up -d db
    ```

    Эта команда создаст и запустит контейнер PostgreSQL в фоновом режиме. Данные будут сохраняться в именованном томе `postgres_data`.

**Остановка БД:**

```bash
docker-compose down
```

### Запуск приложения (Парсера)

Приложение запускается через `main.py` с использованием веб-сервера `uvicorn`. Основная логика парсинга выполняется при старте приложения, а затем каждые 5 минут с использованием `aiocron`.

**Запуск сервера для разработки:**

```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```
- `--reload`: включает автоматическую перезагрузку при изменении кода. Не используйте в production.

**Запуск сервера для production (пример):**

```bash
uvicorn main:app --host 0.0.0.0 --port 8000
```

Сервер будет доступен по адресу `http://localhost:8000` (или IP адресу сервера).
Для проверки состояния доступен эндпоинт: `http://localhost:8000/health`.

Для остановки сервера используйте `Ctrl+C`.

## Правила проекта

Основные соглашения и правила разработки описаны в файле `.cursor/rules/project-guidelines.mdc`. Ключевые моменты:

- Использование паттернов Unit of Work и Repository.
- Минимизация комментариев в коде.
- Поддержание актуальности данного README файла.
- Все ответы/вывод приложения должны быть на русском языке.

---
